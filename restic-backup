#!/bin/bash
NAME=`hostname`
PASSWORD_FILE=~/.resticpw
export RESTIC_PASSWORD=`cat ${PASSWORD_FILE}`
export RESTIC_REPOSITORY=sftp:root@raspberrypi2:/var/Backup/${NAME}
BACKUP_CMD=/usr/bin/restic
BACKUP_SUBCMD=backup
BACKUP_INCLUDE="--files-from /etc/restic-backup-include.conf"
BACKUP_EXCLUDE="--exclude-file /etc/restic-backup-exclude.conf --exclude ${PASSWORD_FILE}"
BACKUP_TAGS="--tag $2"
BACKUP_QUIET=
case "$1" in
    "lan")
	REPOSITORY="-r sftp:root@raspberrypi2:/var/Backup/${NAME}"
	
    ;;
    "onedrive")
	REPOSITORY="-r rclone:onedrive:backup/${NAME}"
    ;;
    *)
	echo "usage: ${BACKUP_CMD} lan|onedrive tag"
	exit 1
	;;
esac
/usr/bin/logger "$0: backup (restic) of ${NAME} to ${RESTIC_REPOSITORY} started."
${BACKUP_CMD} ${BACKUP_SUBCMD} ${BACKUP_QUIET} ${BACKUP_TAGS} ${BACKUP_INCLUDE} ${BACKUP_EXCLUDE}
/usr/bin/logger "$0: backup (restic) of ${NAME} to ${RESTIC_REPOSITORY} finished."
